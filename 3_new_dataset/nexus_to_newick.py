# This script converts the nexus files from MrBayes into Newick files.
# It also saves the tree generated in the last 500 generations into a new file thereby removing the burnin
from Bio import Phylo
import os, argparse

parser = argparse.ArgumentParser()
parser.add_argument("genes")
args = parser.parse_args()
genes=str(args.genes)

os.chdir("/home/kris/dypsidinae/C_large_dataset/7.Nex_files/")
run_too_long=['gene2949', 'gene1212', 'gene5370', 'gene2423', 'gene1457', 'gene3040', 'gene5392', 'gene2480', 'gene409', 'gene2606', 'gene695', 'gene4343', 'gene274', 'gene5323', 'gene4282', 'gene4774', 'gene4115', 'gene3609', 'gene5324', 'gene5351', 'gene2789', 'gene3091', 'gene3518', 'gene754', 'gene4227', 'gene4797', 'gene5446', 'gene3082', 'gene5087', 'gene5017', 'gene4900', 'gene1571', 'gene4800', 'gene2396', 'gene3849', 'gene4868', 'gene4487', 'gene89', 'gene1430', 'gene1211', 'gene3004', 'gene5453', 'gene4207', 'gene3172', 'gene4684', 'gene1567', 'gene4317', 'gene1937', 'gene4701', 'gene73', 'gene3023', 'gene2181', 'gene1534', 'gene131', 'gene4176', 'gene2663', 'gene2642', 'gene3949', 'gene625', 'gene1441', 'gene4412', 'gene935', 'gene5167', 'gene2938', 'gene4420', 'gene2505', 'gene2299', 'gene1819', 'gene3393', 'gene560', 'gene4032', 'gene4446', 'gene3884', 'gene561', 'gene456', 'gene2826', 'gene4857']

if genes in run_too_long:
    Phylo.convert(genes+"_output_tapper.fasta_no_X-out.nex.run1.t~", "nexus", genes+"_run1_newick.t", "newick")
    Phylo.convert(genes+"_output_tapper.fasta_no_X-out.nex.run2.t~", "nexus", genes+"-_run2_newick.t", "newick")
else:
    #converting the files
    Phylo.convert(genes+"_output_tapper.fasta_no_X-out.nex.run1.t", "nexus", genes+"_run1_newick.t", "newick")
    Phylo.convert(genes+"_output_tapper.fasta_no_X-out.nex.run2.t", "nexus", genes+"-_run2_newick.t", "newick")

#excluding burnin and creating files
newick_1=open(genes+"_run1_newick.t","r").readlines()
run1=newick_1[-500:] #taking the last 500 trees generated by run 1 in MrBayes
newick_2=open(genes+"_run2_newick.t","r").readlines()
run2=newick_2[-500:] #taking the last 500 trees generated by run 1 in MrBayes

genetree=open(genes+"_genetree.tre", "a")
for i in run1:
    genetree.write(i)
for t in run2:
    genetree.write(t)
